CREATE TABLE brand (
	id int8 NOT NULL,
	description varchar(50) NOT NULL,
	seller_id int8 NOT NULL,
	CONSTRAINT brand_description_uk UNIQUE (description, seller_id),
	CONSTRAINT brand_pkey PRIMARY KEY (id)
);

CREATE TABLE category (
	id int8 NOT NULL,
	description varchar(50) NOT NULL,
	seller_id int8 NOT NULL,
	CONSTRAINT category_description_uk UNIQUE (description, seller_id),
	CONSTRAINT category_pkey PRIMARY KEY (id)
);

CREATE TABLE product (
	id int8 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 9223372036854775807 START 1 CACHE 1 NO CYCLE) NOT NULL,
	active bool NOT NULL,
	click_count int4 NULL,
	"depth" float8 NOT NULL,
	description text NULL,
	height float8 NOT NULL,
	"name" varchar(100) NOT NULL,
	price numeric(10, 2) NOT NULL,
	stock_alert_enabled bool NULL,
	stock_alert_quantity int4 NULL,
	stock_quantity int4 NOT NULL,
	unit_type varchar(50) NULL,
	weight float8 NOT NULL,
	width float8 NOT NULL,
	youtube_link varchar(1000) NULL,
	brand_id int8 NOT NULL,
	category_id int8 NOT NULL,
	seller_id int8 NOT NULL,
	CONSTRAINT product_name_uk UNIQUE (name, seller_id),
	CONSTRAINT product_pkey PRIMARY KEY (id),
	CONSTRAINT brand_fk FOREIGN KEY (brand_id) REFERENCES brand(id),
	CONSTRAINT category_fk FOREIGN KEY (category_id) REFERENCES category(id)
);

CREATE TABLE product_image (
	id int8 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 9223372036854775807 START 1 CACHE 1 NO CYCLE) NOT NULL,
	original_image text NOT NULL,
	thumbnail_image text NOT NULL,
	product_id int8 NOT NULL,
	seller_id int8 NOT NULL,
	CONSTRAINT product_image_pkey PRIMARY KEY (id),
	CONSTRAINT product_fk FOREIGN KEY (product_id) REFERENCES product(id)
);


CREATE TABLE discount_coupon (
	id int8 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 9223372036854775807 START 1 CACHE 1 NO CYCLE) NOT NULL,
	code varchar(50) NOT NULL,
	discount_amount numeric(38, 2) NULL,
	due_date timestamp(6) NOT NULL,
	percentage numeric(38, 2) NULL,
	seller_id int8 NOT NULL,
	CONSTRAINT dc_code_uk UNIQUE (code),
	CONSTRAINT discount_coupon_pkey PRIMARY KEY (id)
);


CREATE TABLE payment_method (
	id int8 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 9223372036854775807 START 1 CACHE 1 NO CYCLE) NOT NULL,
	payment_type varchar(255) NOT NULL,
	CONSTRAINT payment_method_payment_type_check CHECK (((payment_type)::text = ANY ((ARRAY['CREDIT_CARD'::character varying, 'DEBIT_CARD'::character varying, 'BANK_SLIP'::character varying, 'PIX'::character varying])::text[]))),
	CONSTRAINT payment_method_pkey PRIMARY KEY (id),
	CONSTRAINT payment_type_uk UNIQUE (payment_type)
);

CREATE TABLE "role" (
	id int8 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 9223372036854775807 START 1 CACHE 1 NO CYCLE) NOT NULL,
	"role" varchar(255) NOT NULL,
	CONSTRAINT role_pkey PRIMARY KEY (id),
	CONSTRAINT role_role_check CHECK (((role)::text = ANY ((ARRAY['ROLE_USER'::character varying, 'ROLE_SELLER'::character varying, 'ROLE_ADMIN'::character varying])::text[]))),
	CONSTRAINT role_uk UNIQUE (role)
);

CREATE TABLE person (
	id int8 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 9223372036854775807 START 1 CACHE 1 NO CYCLE) NOT NULL,
	"name" varchar(100) NOT NULL,
	phone varchar(20) NOT NULL,
	CONSTRAINT person_pkey PRIMARY KEY (id),
	CONSTRAINT phone_uk UNIQUE (phone)
);


CREATE TABLE person_fisica (
	cpf varchar(11) NOT NULL,
	date_of_birth date NOT NULL,
	id int8 NOT NULL,
	CONSTRAINT cpf_uk UNIQUE (cpf),
	CONSTRAINT person_fisica_pkey PRIMARY KEY (id),
	CONSTRAINT person_fisica_fk FOREIGN KEY (id) REFERENCES person(id)
);

CREATE TABLE person_juridica (
	category varchar(255) NULL,
	cnpj varchar(14) NOT NULL,
	corporate_name varchar(255) NOT NULL,
	municipal_registration varchar(255) NULL,
	state_registration varchar(255) NULL,
	trade_name varchar(255) NOT NULL,
	id int8 NOT NULL,
	CONSTRAINT cnpj_uk UNIQUE (cnpj),
	CONSTRAINT person_juridica_pkey PRIMARY KEY (id),
	CONSTRAINT person_juridica_fk FOREIGN KEY (id) REFERENCES person(id)
);

CREATE TABLE users (
	id int8 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 9223372036854775807 START 1 CACHE 1 NO CYCLE) NOT NULL,
	email varchar(30) NOT NULL,
	"password" varchar(255) NOT NULL,
	password_updated_at date NOT NULL,
	person_id int8 NOT NULL,
	status varchar(255) DEFAULT 'PENDING'::character varying NOT NULL,
	CONSTRAINT email_uk UNIQUE (email),
	CONSTRAINT users_pkey PRIMARY KEY (id),
	CONSTRAINT users_status_check CHECK (((status)::text = ANY (ARRAY['ACTIVE'::text, 'PENDING'::text, 'INACTIVE'::text, 'LOCKED'::text, 'SUSPENDED'::text, 'DELETED'::text]))),
	CONSTRAINT person_fk FOREIGN KEY (person_id) REFERENCES person(id)
);


CREATE TABLE users_roles (
	user_id int8 NOT NULL,
	role_id int8 NOT NULL,
	CONSTRAINT role_user_uk UNIQUE (user_id, role_id),
	CONSTRAINT role_fk FOREIGN KEY (role_id) REFERENCES "role"(id),
	CONSTRAINT user_fk FOREIGN KEY (user_id) REFERENCES users(id)
);

CREATE TABLE address (
	id int8 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 9223372036854775807 START 1 CACHE 1 NO CYCLE) NOT NULL,
	city varchar(255) NOT NULL,
	complement varchar(255) NULL,
	neighborhood varchar(255) NOT NULL,
	"number" varchar(255) NOT NULL,
	state varchar(255) NOT NULL,
	street varchar(255) NOT NULL,
	"type" varchar(255) NOT NULL,
	zip_code varchar(255) NOT NULL,
	person_id int8 NOT NULL,
	CONSTRAINT address_pkey PRIMARY KEY (id),
	CONSTRAINT address_type_check CHECK (((type)::text = ANY ((ARRAY['BILLING'::character varying, 'DELIVERY'::character varying])::text[]))),
	CONSTRAINT person_fk FOREIGN KEY (person_id) REFERENCES person(id)
);

CREATE TABLE account_payable (
	id int8 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 9223372036854775807 START 1 CACHE 1 NO CYCLE) NOT NULL,
	description varchar(255) NOT NULL,
	discount_amount numeric(10, 2) NULL,
	due_date date NOT NULL,
	payment_date date NULL,
	status varchar(255) NOT NULL,
	total_amount numeric(10, 2) NOT NULL,
	address_id int8 NOT NULL,
	payment_method_id int8 NOT NULL,
	person_id int8 NOT NULL,
	seller_id int8 NOT NULL,
	supplier_id int8 NOT NULL,
	CONSTRAINT account_payable_pkey PRIMARY KEY (id),
	CONSTRAINT account_payable_status_check CHECK (((status)::text = ANY ((ARRAY['PENDING'::character varying, 'PAID'::character varying, 'OVERDUE'::character varying, 'CANCELLED'::character varying, 'NEGOTIATED'::character varying, 'OPEN'::character varying, 'SETTLED'::character varying])::text[]))),
	CONSTRAINT address_fk FOREIGN KEY (address_id) REFERENCES address(id),
	CONSTRAINT payment_method_fk FOREIGN KEY (payment_method_id) REFERENCES payment_method(id),
	CONSTRAINT person_fk FOREIGN KEY (person_id) REFERENCES person(id),
	CONSTRAINT seller_fk FOREIGN KEY (seller_id) REFERENCES person_juridica(id),
	CONSTRAINT supplier_fk FOREIGN KEY (supplier_id) REFERENCES person(id)
);

CREATE TABLE nota_fiscal_compra (
	id int8 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 9223372036854775807 START 1 CACHE 1 NO CYCLE) NOT NULL,
	amount_icms numeric(38, 2) NOT NULL,
	description varchar(255) NULL,
	discount_amount numeric(38, 2) NULL,
	"number" varchar(255) NOT NULL,
	purchase_date timestamp(6) NOT NULL,
	total_amount numeric(38, 2) NOT NULL,
	account_payable_id int8 NULL,
	person_id int8 NOT NULL,
	seller_id int8 NOT NULL,
	CONSTRAINT nfc_account_payable_uk UNIQUE (account_payable_id),
	CONSTRAINT nfc_number_uk UNIQUE (number),
	CONSTRAINT nota_fiscal_compra_pkey PRIMARY KEY (id),
	CONSTRAINT seller_fk FOREIGN KEY (seller_id) REFERENCES person_juridica(id)
);

CREATE TABLE nota_item_product (
	id int8 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 9223372036854775807 START 1 CACHE 1 NO CYCLE) NOT NULL,
	amount numeric(38, 2) NOT NULL,
	quantity float8 NOT NULL,
	nota_fiscal_compra_id int8 NOT NULL,
	product_id int8 NOT NULL,
	seller_id int8 NOT NULL,
	CONSTRAINT nota_item_product_pkey PRIMARY KEY (id),
	CONSTRAINT nota_fiscal_compra_fk FOREIGN KEY (nota_fiscal_compra_id) REFERENCES nota_fiscal_compra(id),
	CONSTRAINT seller_fk FOREIGN KEY (seller_id) REFERENCES person_juridica(id)
);

CREATE TABLE sale_purchase (
	id int8 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 9223372036854775807 START 1 CACHE 1 NO CYCLE) NOT NULL,
	delivery_date date NOT NULL,
	delivery_days int4 NOT NULL,
	discount_amount numeric(38, 2) NULL,
	sale_date date NOT NULL,
	shipping_cost numeric(38, 2) NOT NULL,
	total_amount numeric(38, 2) NOT NULL,
	billing_address_id int8 NULL,
	delivery_address_id int8 NOT NULL,
	discount_coupon_id int8 NULL,
	payment_method_id int8 NOT NULL,
	person_id int8 NOT NULL,
	seller_id int8 NOT NULL,
	CONSTRAINT sale_purchase_pkey PRIMARY KEY (id),
	CONSTRAINT billing_address_fk FOREIGN KEY (billing_address_id) REFERENCES address(id),
	CONSTRAINT delivery_address_fk FOREIGN KEY (delivery_address_id) REFERENCES address(id),
	CONSTRAINT person_fk FOREIGN KEY (person_id) REFERENCES person(id),
	CONSTRAINT seller_fk FOREIGN KEY (seller_id) REFERENCES person_juridica(id)
);

CREATE TABLE sale_item (
	id int8 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 9223372036854775807 START 1 CACHE 1 NO CYCLE) NOT NULL,
	amount numeric(38, 2) NOT NULL,
	quantity float8 NOT NULL,
	product_id int8 NOT NULL,
	sale_purchase_id int8 NOT NULL,
	seller_id int8 NOT NULL,
	CONSTRAINT sale_item_pkey PRIMARY KEY (id),
	CONSTRAINT product_fk FOREIGN KEY (product_id) REFERENCES product(id),
	CONSTRAINT sale_purchase_fk FOREIGN KEY (sale_purchase_id) REFERENCES sale_purchase(id),
	CONSTRAINT seller_fk FOREIGN KEY (seller_id) REFERENCES person_juridica(id)
);

CREATE TABLE nota_fiscal_venda (
	id int8 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 9223372036854775807 START 1 CACHE 1 NO CYCLE) NOT NULL,
	pdf text NOT NULL,
	"xml" text NOT NULL,
	"number" varchar(255) NOT NULL,
	series varchar(255) NOT NULL,
	"type" varchar(255) NOT NULL,
	sale_purchase_id int8 NOT NULL,
	seller_id int8 NOT NULL,
	CONSTRAINT nfv_number_uk UNIQUE (number),
	CONSTRAINT nfv_sale_purchase_uk UNIQUE (sale_purchase_id),
	CONSTRAINT nota_fiscal_venda_pkey PRIMARY KEY (id),
	CONSTRAINT sale_purchase_fk FOREIGN KEY (sale_purchase_id) REFERENCES sale_purchase(id),
	CONSTRAINT seller_fk FOREIGN KEY (seller_id) REFERENCES person_juridica(id)
);

CREATE TABLE tracking_status (
	id int8 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 9223372036854775807 START 1 CACHE 1 NO CYCLE) NOT NULL,
	city varchar(255) NOT NULL,
	distribution_center varchar(255) NOT NULL,
	state varchar(255) NOT NULL,
	status varchar(255) NOT NULL,
	sale_purchase_id int8 NULL,
	CONSTRAINT tracking_status_pkey PRIMARY KEY (id),
	CONSTRAINT ts_sale_purchase_uk UNIQUE (sale_purchase_id),
	CONSTRAINT sale_purchase_fk FOREIGN KEY (sale_purchase_id) REFERENCES sale_purchase(id)
);

CREATE TABLE account_receivable (
	id int8 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 9223372036854775807 START 1 CACHE 1 NO CYCLE) NOT NULL,
	description varchar(255) NULL,
	discount_amount numeric(10, 2) NULL,
	due_date date NOT NULL,
	payment_date date NULL,
	status varchar(255) NOT NULL,
	total_amount numeric(10, 2) NOT NULL,
	person_id int8 NULL,
	sale_purchase_id int8 NULL,
	seller_id int8 NOT NULL,
	CONSTRAINT account_receivable_pkey PRIMARY KEY (id),
	CONSTRAINT account_receivable_status_check CHECK (((status)::text = ANY ((ARRAY['PENDING'::character varying, 'PAID'::character varying, 'OVERDUE'::character varying, 'CANCELLED'::character varying])::text[]))),
	CONSTRAINT ar_sale_purchase_uk UNIQUE (sale_purchase_id),
	CONSTRAINT person_fk FOREIGN KEY (person_id) REFERENCES person(id),
	CONSTRAINT sale_purchase_fk FOREIGN KEY (sale_purchase_id) REFERENCES sale_purchase(id),
	CONSTRAINT seller_fk FOREIGN KEY (seller_id) REFERENCES person_juridica(id)
);

ALTER TABLE brand ADD CONSTRAINT brand_seller_fk FOREIGN KEY (seller_id) REFERENCES person_juridica(id);

ALTER TABLE category ADD CONSTRAINT brand_seller_fk FOREIGN KEY (seller_id) REFERENCES person_juridica(id);

ALTER TABLE product ADD CONSTRAINT brand_seller_fk FOREIGN KEY (seller_id) REFERENCES person_juridica(id);

ALTER TABLE product_image ADD CONSTRAINT brand_seller_fk FOREIGN KEY (seller_id) REFERENCES person_juridica(id);

ALTER TABLE discount_coupon ADD CONSTRAINT brand_seller_fk FOREIGN KEY (seller_id) REFERENCES person_juridica(id);
